(function(e){"use strict";window.wijinputcore={options:{culture:"",invalidClass:"ui-state-error",nullText:"",showNullText:false,hideEnter:false,disableUserInput:false,buttonAlign:"right",showTrigger:false,showSpinner:false,comboItems:undefined,comboWidth:undefined,comboHeight:undefined,initializing:null,initialized:null,triggerMouseDown:null,triggerMouseUp:null,textChanged:null,invalidInput:null},_create:function(){var t=this,n=t.element.width(),r,i;if(t.element[0].tagName.toLowerCase()!=="input"){throw"Target element is not a INPUT"}if(window.wijmoApplyWijTouchUtilEvents){e=window.wijmoApplyWijTouchUtilEvents(e)}if(t.element.is(":hidden")&&t.element.wijAddVisibilityObserver){t.element.wijAddVisibilityObserver(function(){t.destroy();t._create();if(t.element.wijRemoveVisibilityObserver){t.element.wijRemoveVisibilityObserver()}},"wijinput")}t.element.data("widgetName",this.widgetName);e.effects.save(t.element,["width","height"]);t.element.wrap("<div class='wijmo-wijinput ui-widget ui-helper-clearfix"+" ui-state-default ui-corner-all'><span class='wijmo-wijinput-wrapper'>"+"</span></div>");t.element.addClass("wijmo-wijinput-input ui-corner-all").attr({role:"textbox","aria-multiline":false});t.wrapper=t.element.parent();t.outerDiv=t.wrapper.parent();t.outerDiv.width(n);if(t.options.showTrigger){t.triggerBtn=e("<div class='wijmo-wijinput-trigger ui-state-default'>"+"<i class='ui-icon icon16-calendarDay'></i></div>").addClass(t.options.buttonAlign==="left"?"ui-corner-left":"ui-corner-right").attr("role","button").appendTo(t.outerDiv);t.element.attr({role:"combobox","aria-expanded":false})}if(t.options.showSpinner){t.spinner=e("<div class='wijmo-wijinput-spinner wijmo-wijinput-button'></div>");t.spinUp=e("<div class='ui-state-default wijmo-wijinput-spinup'>"+"<span class='ui-icon ui-icon-triangle-1-n'></span></div>").attr("role","button");t.spinDown=e("<div class='ui-state-default wijmo-wijinput-spindown'>"+"<span class='ui-icon ui-icon-triangle-1-s'></span></div>").attr("role","button");if(!t.options.showTrigger){t.spinUp.addClass(t.options.buttonAlign==="left"?"ui-corner-tl":"ui-corner-tr");t.spinDown.addClass(t.options.buttonAlign==="left"?"ui-corner-bl":"ui-corner-br")}t.spinner.append(t.spinUp).append(t.spinDown).appendTo(t.outerDiv);t.element.attr("role","spinner")}if(t.options.showTrigger&&t.options.showSpinner){t.outerDiv.addClass(t.options.buttonAlign==="left"?"ui-input-spinner-trigger-left":"ui-input-spinner-trigger-right")}else{if(t.options.showTrigger){t.outerDiv.addClass(t.options.buttonAlign==="left"?"ui-input-trigger-left":"ui-input-trigger-right")}if(t.options.showSpinner){t.outerDiv.addClass(t.options.buttonAlign==="left"?"ui-input-spinner-left":"ui-input-spinner-right")}}r=t.element.leftBorderWidth()+t.element.rightBorderWidth();t.element.width(t.outerDiv.width()-r);t._initialize();if(t.element.width()>=t.wrapper.width()){i=parseFloat(t.element.css("padding-left").replace(/px/,""),10)||0;i+=parseFloat(t.element.css("padding-right").replace(/px/,""),10)||0;t.element.width(t.element.width()-i)}},_createTextProvider:function(){return undefined},_beginUpdate:function(){},_endUpdate:function(){},_onTriggerClicked:function(){},_initialize:function(){this.element.data("initializing",true);this._trigger("initializing");this.element.data("preText",this.element.val());this.element.data("elementValue",this.element.val());this.element.data("errorstate",false);this.element.data("breakSpinner",true);this.element.data("prevCursorPos",-1);this.element.data("simulating",false);this._createTextProvider();this._beginUpdate();var t=this.options,n=this,r,i=function(e){return(!e.which?e.button:e.which)===1},s=function(t){if(n.options.disabled){return}if(!i(t)){return}n._trySetFocus();n.element.data("breakSpinner",false);n._addState("active",e(this));n._doSpin(e(t.currentTarget).hasClass("wijmo-wijinput-spinup"),true)},o=function(t){if(n.options.disabled){return}if(!i(t)){return}n._stopSpin();n._removeState("active",e(this))};if(this.triggerBtn&&!t.disabledState){this.triggerBtn.bind({mouseover:function(){if(n.options.disabled){return}n._addState("hover",e(this))},mouseout:function(){if(n.options.disabled){return}n._removeState("hover",e(this))},mousedown:function(t){if(n.options.disabled){return}if(!i(t)){return}n._addState("active",e(this));n._trigger("triggerMouseDown")},click:function(t){if(n.options.disabled){return}n._stopEvent(t);n._stopSpin();n._removeState("active",e(this));n._trigger("triggerMouseUp");n._onTriggerClicked();n._trySetFocus()}})}if(this.spinUp&&!t.disabledState){this.spinUp.bind({mouseover:function(){if(n.options.disabled){return}n._addState("hover",e(this))},mouseout:function(){if(n.options.disabled){return}n._removeState("hover",e(this));n._removeState("active",e(this));n._stopSpin()},mousedown:s,mouseup:o})}if(this.spinDown&&!t.disabledState){this.spinDown.bind({mouseover:function(){if(n.options.disabled){return}n._addState("hover",e(this))},mouseout:function(){if(n.options.disabled){return}n._removeState("hover",e(this));n._removeState("active",e(this));n._stopSpin()},mousedown:s,mouseup:o})}this.element.bind({"focus.wijinput":e.proxy(this._onFocus,this),"blur.wijinput":e.proxy(this._onBlur,this),"mouseup.wijinput":e.proxy(this._onMouseUp,this),"keypress.wijinput":e.proxy(this._onKeyPress,this),"keydown.wijinput":e.proxy(this._onKeyDown,this),"keyup.wijinput":e.proxy(this._onKeyUp,this),"change.wijinput":e.proxy(this._onChange,this),"paste.wijinput":e.proxy(this._onPaste,this),"drop.wijinput":e.proxy(this._onDrop,this)});this.element.bind("propertychange.wijinput input.wijinput",e.proxy(this._onInput,this));this.element.data("initializing",false);this._resetData();this._endUpdate();this._updateText();if(this.options.disabledState){r=t.disabled;this.disable();t.disabled=r}if(this.options.disabled){this.disable()}this.element.data("initialized",true);this._trigger("initialized")},_init:function(){},_setOption:function(t,n){e.Widget.prototype._setOption.apply(this,arguments);switch(t){case"buttonAlign":case"showTrigger":case"showSpinner":this._destroy();this._create();break;case"showNullText":this._updateText();break;case"disabled":this.element.attr("disabled",n);this.element[n?"addClass":"removeClass"](this.namespace+"-state-disabled");if(this.triggerBtn!==undefined){this.triggerBtn[n?"addClass":"removeClass"](this.namespace+"-state-disabled")}if(this.spinup!==undefined){this.spinup[n?"addClass":"removeClass"](this.namespace+"-state-disabled")}if(this.spindown!==undefined){this.spindown[n?"addClass":"removeClass"](this.namespace+"-state-disabled")}break}},destroy:function(){e.Widget.prototype.destroy.apply(this,arguments);this._destroy()},_destroy:function(){this.wrapper=undefined;this.outerDiv=undefined;this.element.unbind(".wijinput");this.element.removeData("errorstate").removeData("breakSpinner").removeData("prevCursorPos").removeData("simulating").removeData("isPassword").removeClass("wijmo-wijinput-input").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow").removeAttr("aria-expanded");this.element.parent().replaceWith(this.element);this.element.parent().replaceWith(this.element);e.effects.restore(this.element,["width","height"])},widget:function(){return this.outerDiv},_getCulture:function(e){return Globalize.findClosestCulture(e||this.options.culture)},_addState:function(e,t){if(t.is(":not(.ui-state-disabled)")){t.addClass("ui-state-"+e)}},_removeState:function(e,t){t.removeClass("ui-state-"+e)},_isInitialized:function(){return!this.element.data("initializing")},_setData:function(e){this.setText(e)},_resetData:function(){},_validateData:function(){},getText:function(){if(!this._isInitialized()){return this.element.val()}return this._textProvider.toString(true,false,false)},setText:function(e){if(!this._isInitialized()){this.element.val(e)}else{this._textProvider.set(e);this._updateText()}},getPostValue:function(){if(!this._isInitialized()){return this.element.val()}return this._textProvider.toString(true,false,true)},selectText:function(e,t){if(this.element.is(":disabled")){return}this.element.wijtextselection(e,t)},focus:function(){if(this.element.is(":disabled")){return}this.element.get(0).focus()},isFocused:function(){return this.outerDiv.hasClass("ui-state-focus")},_raiseTextChanged:function(){var e=this.element.val(),t=this.element.data("preText");if(!!this.element.data("initialized")&&t!==e){this._trigger("textChanged",null,{text:e});this.element.data("changed",true)}this.element.data("preText",e)},_raiseDataChanged:function(){},_allowEdit:function(){return!(this.element.attr("readOnly")&&this.element.is(":disabled"))},_updateText:function(e){if(!this._isInitialized()){return}e=!!e;var t=this.element.wijtextselection(),n=this.options;if(this.isDeleteAll&&n.showNullText){this.isDeleteAll=false;n.date=null;this.element.val(n.nullText)}else{this.element.val(this._textProvider.toString());this.options.text=this._textProvider.toString(true,false,false)}if(this.element.is(":disabled")){return}if(e){this.selectText(t.start,t.end)}this.element.data("prevCursorPos",t.start);this._raiseTextChanged();this._raiseDataChanged()},_trySetFocus:function(){if(!this.isFocused()){try{if(!this.options.disableUserInput){this.element.focus()}}catch(e){}}},_deleteSelText:function(e){if(!this._allowEdit()){return}var t=this.element.wijtextselection(),n;e=!!e;if(e){if(t.end===t.start){if(t.end>=1){t.end=t.end-1;t.start=t.start-1}else{return}}else{t.end=t.end-1}}else{t.end=t.end-1}if(t.end<t.start){t.end=t.start}n=new wijInputResult;this._textProvider.removeAt(t.start,t.end,n);this._updateText();this.selectText(n.testPosition,n.testPosition)},_fireIvalidInputEvent:function(e){var t=this,n;if(t._trigger("invalidInput",null,{widget:t,"char":e})===true){return}if(!t.element.data("errorstate")){n=t.options.invalidClass||"ui-state-error";t.element.data("errorstate",true);window.setTimeout(function(){t.outerDiv.removeClass(n);t.element.data("errorstate",false)},100);t.outerDiv.addClass(n)}},_onInput:function(e){if(!this._isSimulating()||!this.element.data("ime")){return}this._simulate()},_keyDownPreview:function(e){return false},_beforeSimulate:function(e){if(!this.element.data("lastSelection")){this.element.data("lastSelection",this.element.wijtextselection());this.element.data("lastValue",this.element.val())}this.element.data("ime",e);this.element.data("simulating",true)},_isSimulating:function(){return this.element.data("simulating")},_simulate:function(e){var t=this,n=null,r,i,s;if(typeof e==="string"){n=e}else{r=this.element.wijtextselection();i=this.element.data("lastSelection").start;s=r.end;if(s>=i){n=this.element.val().substring(i,s)}}if(n){window.setTimeout(function(){if(!t.element.data("lastValue")){return}t.element.val(t.element.data("lastValue"));var e=t.element.data("lastSelection"),r,i;t.element.wijtextselection(e);t.element.data("batchKeyPress",true);t.element.data("simulating",false);r=jQuery.Event("keypress");r.ctrlKey=r.altKey=false;for(i=0;i<n.length;i++){r.which=r.charCode=r.keyCode=n.charCodeAt(i);t._onKeyPress(r)}t.element.data("batchKeyPress",false);t._endSimulate()},1)}},_endSimulate:function(){this.element.removeData("ime");this.element.removeData("lastSelection");this.element.removeData("lastValue")},_onKeyDown:function(t){this.element.data("prevCursorPos",-1);if(!this._isInitialized()||this._textProvider&&!!this._textProvider.noMask){return}var n=this._getKeyCode(t);if(n===229){this._beforeSimulate(true);return}this._endSimulate();if(this.options.disableUserInput){this._stopEvent(t);return}if(this._keyDownPreview(t)){this._stopEvent(t);return}switch(n){case e.ui.keyCode.UP:this._doSpin(true,false);this._stopEvent(t);return;case e.ui.keyCode.DOWN:this._doSpin(false,false);this._stopEvent(t);return}if(t.ctrlKey){switch(n){case e.ui.keyCode.INSERT:case 67:return;default:break}}if(t.ctrlKey||t.altKey){return}switch(n){case 112:case 113:case 114:case 115:case 116:case 117:case e.ui.keyCode.TAB:case e.ui.keyCode.CAPSLOCK:case e.ui.keyCode.END:case e.ui.keyCode.HOME:case e.ui.keyCode.CTRL:case e.ui.keyCode.SHIFT:return;case e.ui.keyCode.BACKSPACE:this._deleteSelText(true);this._stopEvent(t);return;case e.ui.keyCode.DELETE:this._deleteSelText(false);this._stopEvent(t);return;case e.ui.keyCode.ENTER:if(!this.options.hideEnter){return}break;case e.ui.keyCode.ESCAPE:this._stopEvent(t);window.setTimeout(e.proxy(this._resetData,this),1);return;case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.ALT:this._stopEvent(t);return}},_onKeyUp:function(t){if(this._isSimulating()||this._textProvider&&!!this._textProvider.noMask){return}var n=this._getKeyCode(t);if(!this._isInitialized()){return}if(n===e.ui.keyCode.ENTER){return}if(n===e.ui.keyCode.ESCAPE){return}if(this.options.disableUserInput){this._raiseTextChanged();this._raiseDataChanged();return}this._stopEvent(t)},_getKeyCode:function(e){var t=window.navigator.userAgent;if((t.indexOf("iPod")!==-1||t.indexOf("iPhone")!==-1)&&e.which===127){return 8}return e.keyCode||e.which},_keyPressPreview:function(e){return false},_onKeyPress:function(t){if(this._isSimulating()||this._textProvider&&!!this._textProvider.noMask){return}this.element.data("prevCursorPos",-1);if(this.options.disableUserInput){return}if(!this._allowEdit()){return}if(t.ctrlKey&&t.keyCode===119){this._onPaste(t);return}if(t.which===0){return}var n=t.keyCode||t.which,r,i,s,o;if(n===e.ui.keyCode.BACKSPACE){this._stopEvent(t);return}if(t.ctrlKey||t.altKey){if(n!==e.ui.keyCode.SPACE){return}}if(this._keyPressPreview(t)){return}if(n===e.ui.keyCode.ENTER&&!this.options.hideEnter){return true}r=this.element.wijtextselection();i=String.fromCharCode(n);if(r.start<r.end){this._textProvider.removeAt(r.start,r.end-1,new wijInputResult,true)}s=new wijInputResult;o=this._textProvider.insertAt(i,r.start,s);if(o){this._updateText();this.selectText(s.testPosition+1,s.testPosition+1)}else{this._fireIvalidInputEvent(i)}if(!this.element.data("batchKeyPress")){this._stopEvent(t)}},_isNullText:function(e){e=e||this.element.val();return this.options.showNullText&&e===this.options.nullText},_doFocus:function(){var t=this.element.wijtextselection(),n=t.start,r;this._updateText();r=this.element.val();if(r.length===n){n=0}if(!e.browser.safari){this.selectText(n,n)}},_afterFocused:function(){if(this._isNullText()){this._doFocus()}},_onFocus:function(e){if(this.options.disableUserInput){return}this._addState("focus",this.outerDiv);if(!this.element.data("breakSpinner")){return}if(!this._isInitialized()){return}if(!this._allowEdit()){return}if(!this.element.data("focusNotCalledFirstTime")){this.element.data("focusNotCalledFirstTime",(new Date).getTime())}this._afterFocused()},_onBlur:function(e){if(this.options.disableUserInput){return}if(this._isComboListVisible()){return}var t=this.isFocused(),n,r=this;this._removeState("focus",this.outerDiv);if(!this.element.data("breakSpinner")){this.element.get(0).focus();n=this.element.data("prevCursorPos");if(n!==undefined&&n!==-1){this.selectText(n,n)}return}if(!this._isInitialized()){return}if(!t){return}this.element.data("value",this.element.val());window.setTimeout(function(){r._onChange();r._updateText();r._validateData();if(!r._popupVisible()&&!!r.element.data("changed")){r._trigger("change")}r.element.data("changed",false)},100)},_popupVisible:function(){return this._isComboListVisible()},_onMouseUp:function(e){if(!this._isInitialized()){return}if(this.element.is(":disabled")){return}var t=this.element.wijtextselection();this.element.data("prevCursorPos",t.start)},_onChange:function(e){if(!this.element){return}var t=this.element.val(),n=this.getText();if(n!==t){this.setText(t)}},_onPaste:function(e){if(this._textProvider&&!!this._textProvider.noMask){return}this._beforeSimulate();var t=this;window.setTimeout(function(){t._simulate()},1)},_onDrop:function(e){this._beforeSimulate();if(e.originalEvent&&e.originalEvent.dataTransfer){var t=e.originalEvent.dataTransfer.getData("Text");if(t){this._simulate(t)}}},_stopEvent:function(e){e.stopPropagation();e.preventDefault()},_calcSpinInterval:function(){this._repeatingCount++;if(this._repeatingCount>10){return 50}else if(this._repeatingCount>4){return 100}else if(this._repeatingCount>2){return 200}return 400},_doSpin:function(){},_stopSpin:function(){this.element.data("breakSpinner",true);this._repeatingCount=0},_hasComboItems:function(){return!!this.options.comboItems&&this.options.comboItems.length},_isComboListVisible:function(){if(!this._comboDiv){return false}return this._comboDiv.wijpopup("isVisible")},_popupComboList:function(){if(!this._hasComboItems()){return}if(!this._allowEdit()){return}if(this._isComboListVisible()){this._comboDiv.wijpopup("hide");return}var t=this,n;if(this._comboDiv===undefined){this._comboDiv=e("<div></div>").appendTo(document.body).width(this.element.width()).height(this.options.comboHeight||180).css("position","absolute");n=this._normalize(this.options.comboItems);this._comboDiv.wijlist({autoSize:true,maxItemsCount:5,selected:function(e,n){t._setData(n.item.value);t._comboDiv.wijpopup("hide");t._trySetFocus()}});this._comboDiv.wijlist("setItems",n);this._comboDiv.wijlist("renderList");this._comboDiv.wijlist("refreshSuperPanel")}this._comboDiv.wijpopup({autoHide:true});this.outerDiv.attr("aria-expanded",true);this._comboDiv.wijpopup("show",{of:this.outerDiv,offset:"0 4",hidden:function(){t.outerDiv.attr("aria-expanded",false)}})},_normalize:function(t){if(t.length&&t[0].label&&t[0].value){return t}return e.map(t,function(t){if(typeof t==="string"){return{label:t,value:t}}return e.extend({label:t.label||t.value,value:t.value||t.label},t)})}};window.wijInputResult=function(){this.alphanumericCharacterExpected=-2;this.asciiCharacterExpected=-1;this.digitExpected=-3;this.invalidInput=-51;this.letterExpected=-4;this.nonEditPosition=-54;this.positionOutOfRange=-55;this.promptCharNotAllowed=-52;this.signedDigitExpected=-5;this.unavailableEditPosition=-53;this.testPosition=-1};window.wijInputResult.prototype={characterEscaped:1,noEffect:2,sideEffect:3,success:4,unknown:0,hint:0,clone:function(){var e=new wijInputResult;e.hint=this.hint;e.testPosition=this.testPosition;return e}}})(jQuery)