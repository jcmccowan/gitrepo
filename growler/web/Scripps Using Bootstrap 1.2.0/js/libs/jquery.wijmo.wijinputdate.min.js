(function(e){"use strict";var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;e.widget("wijmo.wijinputdate",e.extend(true,{},wijinputcore,{options:{date:null,minDate:null,maxDate:null,dateFormat:"d",startYear:1950,smartInputMode:true,activeField:0,keyDelay:800,autoNextField:true,calendar:"default",popupPosition:{offset:"0 4"},dateChanged:null},_createTextProvider:function(){this._textProvider=new t(this,this.options.dateFormat)},_strToDate:function(e){return this._textProvider.parseDate(e)},_beginUpdate:function(){var e=this.options,t,n=null;if(e.minDate){if(typeof e.minDate==="string"){e.minDate=this._strToDate(e.minDate)}}if(e.maxDate){if(typeof e.maxDate==="string"){e.maxDate=this._strToDate(e.maxDate)}}if(!e.date){if(!!this.element.data("elementValue")){t=this.element.data("elementValue")}}else{if(typeof e.date==="string"){t=e.date}else{n=e.date}}if(t){n=this._strToDate(t)}this._safeSetDate(n);this.element.data({defaultDate:n===null?n:new Date(e.date.getTime()),preDate:n===null?n:new Date(e.date.getTime())});this._resetTimeStamp();if(e.showTrigger&&!this._hasComboItems()){this._initCalendar()}this.element.addClass("wijmo-wijinput-date").attr({"aria-valuemin":new Date(1900,1,1),"aria-valuemax":new Date(2099,1,1),"aria-valuenow":e.date})},_endUpdate:function(){var e=this;this.element.click(function(){e._highLightCursor()});this.element.mousewheel(function(t,n){e._doSpin(n>0,false)})},_onTriggerClicked:function(){if(this._hasComboItems()){this._popupComboList()}else{this._popupOrHideCalendar()}},_isValidDate:function(e,t){var n=this.options;if(e===undefined){return false}if(isNaN(e)){return false}if(e.getFullYear()<1||e.getFullYear()>9999){return false}if(t){if(n.minDate){if(e<n.minDate){return false}}if(n.maxDate){if(e>n.maxDate){return false}}}return true},_checkRange:function(e){var t=this.options;if(!!e){if(t.minDate&&e<t.minDate){e=new Date(Math.max(t.minDate,e))}if(t.maxDate&&e>t.maxDate){e=new Date(Math.min(t.maxDate,e))}}return e},_safeSetDate:function(e){var t=this.options,n=e;e=this._checkRange(e);if(isNaN(e)){e=n}t.date=e;return true},_safeGetDate:function(){var e=this.options,t=e.date;if(!t){t=new Date}t=this._checkRange(t);return t},_setOption:function(t,n){e.Widget.prototype._setOption.apply(this,arguments);wijinputcore._setOption.apply(this,arguments);switch(t){case"date":if(!!n){if(typeof n==="string"){n=this._strToDate(n)}else if(typeof n==="object"){n=new Date(n.getTime())}else{n=new Date(n)}if(isNaN(n)){n=new Date}}this._safeSetDate(n);this._updateText();this._highLightField();break;case"dateFormat":case"culture":this._textProvider._setFormat(this.options.dateFormat);this._updateText();var r=this.element.data("calendar",r);if(r){r.wijcalendar("option",t,n)}break;case"activeField":n=Math.min(n,this._textProvider.getFieldCount()-1);n=Math.max(n,0);this.options.activeField=n;this._highLightField();this._resetTimeStamp();break;case"nextTooltip":case"prevTooltip":case"titleFormat":case"toolTipFormat":var r=this.element.data("calendar",r);if(r){r.wijcalendar("option",t,n)}break}},_setData:function(e){this.option("date",e)},_resetData:function(){var e=this.element.data("defaultDate");if(e===undefined||e===null){e=this.element.data("elementValue");if(e!==undefined&&e!==null&&e!==""){this.setText(e)}else{this._setData(null)}}else{this._setData(e)}},_resetTimeStamp:function(){this.element.data("cursorPos",0);this.element.data("timeStamp",new Date("1900/1/1"))},getPostValue:function(){if(!this._isInitialized()){return this.element.val()}if(this.options.showNullText&&this.isDateNull()){return""}var e=this._textProvider.toString();if(e===this.options.nullText){return""}return e},_highLightField:function(e){if(e===undefined){e=this.options.activeField}if(this.isFocused()){var t=this._textProvider.getFieldRange(e);if(t){this.element.wijtextselection(t)}}},_highLightCursor:function(e){if(this._isNullText()){return}if(e===undefined){e=Math.max(0,this.element.wijtextselection().start)}var t=this._textProvider.getCursorField(e);if(t<0){return}this._setOption("activeField",t)},_toNextField:function(){this._setOption("activeField",this.options.activeField+1)},_toPrevField:function(){this._setOption("activeField",this.options.activeField-1)},_toFirstField:function(){this._setOption("activeField",0)},_toLastField:function(){this._setOption("activeField",this._textProvider.getFieldCount())},_clearField:function(e){if(e===undefined){e=this.options.activeField}var t=this._textProvider.getFieldRange(e),n,r=this;if(t){n=new wijInputResult;this._textProvider.removeAt(t.start,t.end,n);this._updateText();window.setTimeout(function(){r._highLightField()},1)}},_doSpin:function(t,n){t=!!t;n=!!n;if(!this._allowEdit()){return}if(n&&this.element.data("breakSpinner")){return}if(this._textProvider[t?"incEnumPart":"decEnumPart"]()){this._updateText();this._highLightField()}if(n&&!this.element.data("breakSpinner")){window.setTimeout(e.proxy(function(){this._doSpin(t,true)},this),this._calcSpinInterval())}},_onChange:function(e){},_afterFocused:function(){if(this._isNullText()){this._doFocus()}var e=this,t=function(){e._highLightCursor();e._resetTimeStamp()};window.setTimeout(t,10)},_keyDownPreview:function(t){var n=t.keyCode||t.which,r;switch(n){case e.ui.keyCode.LEFT:this._toPrevField();return true;case e.ui.keyCode.RIGHT:this._toNextField();return true;case e.ui.keyCode.TAB:case e.ui.keyCode.SPACE:case 188:case 190:case 110:case 191:if(t.shiftKey){if(this.options.activeField>0){this._toPrevField();return true}}else{if(this.options.activeField<this._textProvider.getFieldCount()-1){this._toNextField();return true}}break;case e.ui.keyCode.HOME:if(t.ctrlKey){this._setOption("date",new Date)}else{this._toFirstField()}return true;case e.ui.keyCode.END:if(t.ctrlKey){this._setOption("date",new Date("1970/1/1"))}else{this._toLastField()}return true;case e.ui.keyCode.DELETE:if(this._allowEdit()){r=this.element.wijtextselection();if(r.end-r.start===this.element.val().length){this.isDeleteAll=true;this._setOption("date",new Date("1970/1/1"))}else{this._clearField()}return true}break}return false},_autoMoveToNextField:function(e,t){if(!this.options.autoNextField){return}if(this._textProvider.needToMove(this.options.activeField,e,t)){this._toNextField()}},_keyPressPreview:function(t){var n=t.keyCode||t.which,r,i,s,o,u,a,f,l,c;if(n===e.ui.keyCode.ENTER){if(this.isDateNull()){this.options.date=new Date}return false}r=this._textProvider.getFieldRange(this.options.activeField);if(r){if(n===e.ui.keyCode.TAB){return true}if(n===e.ui.keyCode.SPACE){this._stopEvent(t);return true}i=String.fromCharCode(n);s=this._textProvider.isFieldSep(i,this.options.activeField);if(s){this._toNextField();this._stopEvent(t);return true}o=this.element.data("cursorPos");u=new Date;f=this.element.data("timeStamp");this.element.data("timeStamp",u);a=u.getTime()-f.getTime()>this.options.keyDelay;if(a){o=0}l=r.start+o;this.element.data("cursorPos",++o);c=this._textProvider.addToField(i,this.options.activeField,l,!a);if(c){this._updateText();this._autoMoveToNextField(o,i);this._highLightField()}else{this._resetTimeStamp();this._fireIvalidInputEvent()}this._stopEvent(t);return true}return false},_raiseDataChanged:function(){var e=this.options.date,t=this.element.data("preDate");this.element.data("preDate",!e?null:new Date(e.getTime()));if(!t&&e||t&&!e||t&&e&&t.getTime()!==e.getTime()){this._syncCalendar();this.element.attr("aria-valuenow",e);this._trigger("dateChanged",null,{date:e})}},isDateNull:function(){return this.options.date===null||this.options.date===undefined},_isMinDate:function(e){return e.getFullYear()===1&&e.getMonth()===0&&e.getDate()===1},_initCalendar:function(){var t=this,n=t.options,r=n.calendar,i;if(r===undefined||r===null){return}if(typeof r==="boolean"||r==="default"){r=e("<div/>");r.appendTo(document.body)}i=e(r);if(i.length!==1){return}t.element.data("calendar",i);i.wijcalendar({popupMode:true,culture:n.culture,nextTooltip:n.nextTooltip||"Next",prevTooltip:n.prevTooltip||"Previous",titleFormat:n.titleFormat||"MMMM yyyy",toolTipFormat:n.toolTipFormat||"dddd, MMMM dd, yyyy",selectedDatesChanged:function(){var n=e(this).wijcalendar("getSelectedDate");e(this).wijcalendar("close");if(!!n){t.option("date",n)}t._trySetFocus()}});t._syncCalendar()},_syncCalendar:function(){var e=this.element.data("calendar"),t,n;if(!e){return}t=this.options;n=this._safeGetDate();if(this._isMinDate(n)){n=new Date}e.wijcalendar("option","displayDate",n);if(t.minDate){e.wijcalendar("option","minDate",t.minDate)}if(t.maxDate){e.wijcalendar("option","maxDate",t.maxDate)}e.wijcalendar("unSelectAll");e.wijcalendar("selectDate",n);e.wijcalendar("refresh")},_popupOrHideCalendar:function(){if(!this._allowEdit()){return}var t=this.element.data("calendar");if(!t){return}if(t.wijcalendar("isPopupShowing")){t.wijcalendar("hide");this._trySetFocus();return}this._syncCalendar();t.wijcalendar("popup",e.extend({},this.options.popupPosition,{of:this.outerDiv}))},_isCalendarVisible:function(){if(!this._allowEdit()){return false}var e=this.element.data("calendar");if(!e){return false}return e.wijcalendar("isPopupShowing")},_popupVisible:function(){if(this._hasComboItems()){return this._isComboListVisible()}else{return this._isCalendarVisible()}return false}}));t=function(e,t){this.inputWidget=e;this.descriptors=new Array(0);this.desPostions=new Array(0);this.fields=new Array(0);this._setFormat(t)};t.prototype={descriptors:undefined,desPostions:undefined,maskPartsCount:0,pattern:"M/d/yyyy",initialize:function(){},getFieldCount:function(){return this.fields.length},getFieldRange:function(e){var t=this.fields[e];return{start:t.startIndex,end:t.startIndex+t.getText().length}},getCursorField:function(t){t=Math.min(t,this.desPostions.length-1);t=Math.max(t,0);var n=this.desPostions[t].desc,r;if(n.type===-1){r=e.inArray(n,this.descriptors);if(r>0&&this.descriptors[r-1].type!==-1){n=this.descriptors[r-1]}else{return-1}}return e.inArray(n,this.fields)},needToMove:function(e,t,n){if(!this.inputWidget._isValidDate(this.inputWidget._safeGetDate(),true)){return false}var r=this.fields[e],i;if(t===r.maxLen){return true}i=n*1;if(isNaN(i)){return false}switch(r.type){case 20:case 25:case 45:case 46:return i>1;case 47:case 48:return i>2;case 30:case 31:return i>3;case 50:case 51:case 60:case 61:return i>6}return false},_getCulture:function(){return this.inputWidget._getCulture()},_isDigitString:function(t){t=e.trim(t);if(t.length===0){return true}var n=t.charAt(0),r,i;if(n==="+"||n==="-"){t=t.substr(1);t=e.trim(t)}if(t.length===0){return true}try{r=parseFloat(t);i=r.toString();return i===t}catch(s){return false}},_setFormat:function(t){this.descriptors=[];var n="",r="",i=false,s=false,o,u;this.pattern=this._parseFormatToPattern(t);for(o=0;o<this.pattern.length;o++){u=this.pattern.charAt(o);if(s){this.descriptors.push(this.createDescriptor(-1,u));n="";s=false;continue}if(u==="\\"){s=true;if(n.length>0){if(!this.handlePattern(n)){this.descriptors.push(this.createDescriptor(-1,r))}n=""}continue}if(u==="'"){if(i){i=false;n=""}else{i=true;if(n.length>0){if(!this.handlePattern(n)){this.descriptors.push(this.createDescriptor(-1,r))}n=""}}continue}if(i){this.descriptors.push(this.createDescriptor(-1,u));n="";continue}if(!o){r=u}if(r!==u&&n.length>0){if(!this.handlePattern(n)){this.descriptors.push(this.createDescriptor(-1,r))}n=""}n+=u;r=u}if(n.length>0){if(!this.handlePattern(n)){this.descriptors.push(this.createDescriptor(-1,r))}}this.fields=e.grep(this.descriptors,function(e){return e.type!==-1})},_parseFormatToPattern:function(e){var t=this.inputWidget._getCulture().calendars.standard,n=t.patterns.d;if(e.length<=1){switch(e){case"":case"d":n=t.patterns.d;break;case"D":n=t.patterns.D;break;case"f":n=t.patterns.D+" "+t.patterns.t;break;case"F":n=t.patterns.D+" "+t.patterns.T;break;case"g":n=t.patterns.d+" "+t.patterns.t;break;case"G":n=t.patterns.d+" "+t.patterns.T;break;case"m":n=t.patterns.M;break;case"M":n=t.patterns.M;break;case"s":n=t.patterns.S;break;case"t":n=t.patterns.t;break;case"T":n=t.patterns.T;break;case"u":n=t.patterns.S;break;case"U":n=t.patterns.D+" "+t.patterns.T;break;case"y":n=t.patterns.Y;break;case"Y":n=t.patterns.Y;break}}else{n=e}return n},getDate:function(){return!!this.inputWidget?new Date(this.inputWidget._safeGetDate().getTime()):undefined},setDate:function(e){if(this.inputWidget){this.inputWidget._setData(e)}},_internalSetDate:function(e){if(this.inputWidget){var t=this,n=this.inputWidget.options,r=this.inputWidget.element,i=!!r.data("typing"),s;if(i){n.date=e;s=function(){var e=new Date,i=r.data("timeStamp");if(e.getTime()-i.getTime()>n.keyDelay){t.inputWidget._safeSetDate(n.date);t.inputWidget._updateText();t.inputWidget._highLightField()}else{window.setTimeout(s,n.keyDelay)}};window.setTimeout(s,n.keyDelay)}else{this.inputWidget._safeSetDate(e)}}},daysInMonth:function(e,t){e=e-1;var n=(new Date(t,++e,1,-1)).getDate();return n},setYear:function(e,t,n){try{if(t&&t.isfullreset){t.offset=1;e="1970"}if(typeof e==="string"){if(!this._isDigitString(e)){return false}}e=e*1;var r=this.inputWidget.options,i=1,s=9999,o,u,a;if(n){if(r.minDate){i=Math.max(i,r.minDate.getFullYear())}if(r.maxDate){s=Math.min(s,r.maxDate.getFullYear())}}if(t&&t.isreset){e=i}if(e<i){e=i}if(e>s){e=s}o=this.getDate();u=new Date(o.getTime());u.setFullYear(e);if(this._isValidDate(u)){a=this.daysInMonth(this.getMonth(),this.getYear());if(a===o.getDate()){u=new Date(o.getTime());u.setDate(1);u.setFullYear(e);a=this.daysInMonth(u.getMonth()+1,u.getFullYear());u.setDate(a);if(this._isValidDate(u)){this._internalSetDate(u);return true}else{return false}}o.setFullYear(e);this._internalSetDate(o);return true}else{if(t&&t.isreset){o.setFullYear(1);this._internalSetDate(o);return true}return false}}catch(f){return false}},getYear:function(){try{var e=this.getDate().getFullYear();e=""+e+"";while(e.length<4){e="0"+e}return""+e+""}catch(t){alert("getYear() failed")}return""},setMonth:function(e,t,n){try{if(n&&n.isfullreset){e="1"}e=e*1;var r=this.getDate(),i,s;if(typeof t!=="undefined"&&!t){if(e>12||e<1){if(n&&n.isreset){e=1}else{return false}}}i=this.daysInMonth(this.getMonth(),this.getYear());if(i===this.getDate().getDate()){s=new Date(r.getTime());s.setDate(1);s.setMonth(e-1);i=this.daysInMonth(s.getMonth()+1,s.getFullYear());s.setDate(i);if(this._isValidDate(s)){this._internalSetDate(s);return true}else{return false}}else{s=new Date(r.getTime());s.setMonth(e-1);if(this._isValidDate(s)){this._internalSetDate(s);return true}else{return false}}}catch(o){return false}},getMonth:function(){return this.getDate().getMonth()+1},setDayOfMonth:function(e,t,n){try{if(n&&n.isfullreset){return this.setDayOfMonth(1,t)}var r=this.getDate(),i,s;e=e*1;if(typeof t!=="undefined"&&!t){i=this.daysInMonth(this.getMonth(),this.getYear());if(e>i||e<1){if(n&&n.isreset){return this.setDayOfMonth(1,t,n)}return false}}s=new Date(r.getTime());s.setDate(e);if(this._isValidDate(s)){this._internalSetDate(s);return true}else{return false}}catch(o){return false}},getDayOfMonth:function(){return this.getDate().getDate()},setHours:function(e,t){try{e=e*1;if(typeof t!=="undefined"&&!t){if(e>24){return false}}var n=new Date(this.getDate().getTime());n.setHours(e);if(this._isValidDate(n)){this._internalSetDate(n);return true}else{return false}}catch(r){return false}},getHours:function(){return this.getDate().getHours()},setMinutes:function(e,t){try{e=e*1;if(typeof t!=="undefined"&&!t){if(e>60){return false}}var n=new Date(this.getDate().getTime());n.setMinutes(e);if(this._isValidDate(n)){this._internalSetDate(n);return true}else{return false}}catch(r){return false}},getMinutes:function(){return this.getDate().getMinutes()},setSeconds:function(e,t){try{e=e*1;if(typeof t!=="undefined"&&!t){if(e>60){return false}}var n=new Date(this.getDate().getTime());n.setSeconds(e);if(this._isValidDate(n)){this._internalSetDate(n);return true}else{return false}}catch(r){return false}},getSeconds:function(){return this.getDate().getSeconds()},setDayOfWeek:function(e){try{e=e*1;var t=e-this.getDayOfWeek()*1;return this.setDayOfMonth(this.getDayOfMonth()*1+t*1,true)}catch(n){return false}},getDayOfWeek:function(){return this.getDate().getDay()+1},handlePattern:function(e){var t=new RegExp("y{3,4}"),n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(10));return true}t=new RegExp("y{2,2}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(2));return true}t=new RegExp("y{1,1}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(1));return true}t=new RegExp("d{4,4}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(101));return true}t=new RegExp("d{3,3}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(100));return true}t=new RegExp("d{2,2}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(30));return true}t=new RegExp("d{1,1}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(31));return true}t=new RegExp("M{4,4}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(27));return true}t=new RegExp("M{3,3}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(26));return true}t=new RegExp("M{2,2}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(20));return true}t=new RegExp("M{1,1}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(25));return true}t=new RegExp("h{2,2}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(46));return true}t=new RegExp("h{1,1}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(45));return true}t=new RegExp("H{2,2}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(48));return true}t=new RegExp("H{1,1}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(47));return true}t=new RegExp("m{2,2}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(50));return true}t=new RegExp("m{1,1}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(51));return true}t=new RegExp("s{2,2}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(60));return true}t=new RegExp("s{1,1}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(61));return true}t=new RegExp("t{2,2}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(251));return true}t=new RegExp("t{1,1}");n=t.test(e);if(n){this.descriptors.push(this.createDescriptor(250));return true}return false},createDescriptor:function(e,t){var n=null,r=this.maskPartsCount++;switch(e){case-1:n=new i(this,r);n.liternal=t;break;case 20:n=new s(this,r);break;case 25:n=new o(this,r);break;case 26:n=new u(this,r);break;case 27:n=new a(this,r);break;case 30:n=new f(this,r);break;case 31:n=new l(this,r);break;case 100:n=new c(this,r);break;case 101:n=new h(this,r);break;case 10:n=new p(this,r);break;case 1:n=new d(this,r);break;case 2:n=new v(this,r);break;case 45:n=new m(this,r);break;case 46:n=new g(this,r);break;case 47:n=new y(this,r);break;case 48:n=new b(this,r);break;case 250:n=new w(this,r);break;case 251:n=new E(this,r);break;case 50:n=new S(this,r);break;case 51:n=new x(this,r);break;case 60:n=new T(this,r);break;case 61:n=new N(this,r);break;default:break}return n},toString:function(){if(this.inputWidget.options.showNullText&&!this.inputWidget.isFocused()&&this.inputWidget.isDateNull()){return this.inputWidget.options.nullText}var e="",t=0,n,r,i,s;this.desPostions=new Array(0);for(n=0;n<this.descriptors.length;n++){this.descriptors[n].startIndex=e.length;r=""||this.descriptors[n].getText();e+=r;for(i=0;i<r.length;i++){s={};s.desc=this.descriptors[n];s.pos=i;s.text=r;s.length=r.length;this.desPostions.push(s);t++;if(this.desPostions.length!==t){throw"Fatal Error !!!!!!!!!!!!!!!"}}}return e},parseDate:function(e){var t;if(this.pattern==="dddd"||this.pattern==="ddd"||typeof e==="object"){try{t=new Date(e);if(isNaN(t)){t=new Date}}catch(n){t=new Date}}else{t=Globalize.parseDate(e,this.pattern,this._getCulture());if(!t){t=this._tryParseDate(e,this.pattern)}if(!t){t=new Date}}return t},set:function(e,t){this._internalSetDate(new Date(this.parseDate(e)));return true},haveEnumParts:function(){return false},removeLiterals:function(e){e=""+e+"";e=e.replace(new RegExp("\\s","g"),"");e=e.replace(new RegExp("[+]","g"),"");e=e.replace(new RegExp("[.]","g"),"");e=e.replace(new RegExp("[:]","g"),"");e=e.replace(new RegExp("[-]","g"),"");e=e.replace(new RegExp("[()=]","g"),"");return e},getFirstDelimiterPos:function(e,t){var n=0,r=0,i,s;while(n<t.length&&r<e.length){i=t.charAt(n);s=e.charAt(r);if(i===s){r++}else{return r-1}n++}return e.length-1},findAlikeArrayItemIndex:function(e,t){var n=-1,r=99999,i,s;for(i=0;i<e.length;i++){s=e[i].toLowerCase().indexOf(t.toLowerCase());if(s!==-1&&s<r){r=s;n=i}}return n},_isValidDate:function(e){return this.inputWidget._isValidDate(e)},isFieldSep:function(e,t){var n=t++,r;if(n<this.descriptors.length){r=this.descriptors[n];if(r.type!==-1){return false}return e===r.text}return false},getPositionType:function(e){var t=this.desPostions[e];return t.desc.type},addToField:function(e,t,n,r){var i=this.fields[t],s,o,u;if(i.type===10){return this.insertAt(e,n)}s=r?i.getText()+e:e;o={val:e,pos:0,offset:0,isreset:false};this.inputWidget.element.data("typing",true);u=i.setText(s,e.length===1?false:true,o);this.inputWidget.element.data("typing",false);return u},insertAt:function(e,t,n){if(!n){n=new wijInputResult}n.testPosition=-1;var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;if(e.length===1){r=this.desPostions[t];if(r&&r.desc.type===-1){if(r.text===e){n.testPosition=t;n.hint=n.characterEscaped;return true}}}i=e;s=t;e=this.removeLiterals(e);o=e;u=false;f=false;if(s>0&&o.length===1){s--;t=s;r=this.desPostions[s];u=true;if(r&&(r.desc.type===-1||r.desc.getText().length!==1)){t++;s++;u=false}}a=false;while(o.length>0&&s<this.desPostions.length){r=this.desPostions[s];if(r.desc.type===-1){s=s+r.length;continue}if(r.desc.needAdjustInsertPos()){l=o.substr(0,r.length-r.pos);l=r.text.slice(0,r.pos)+l+r.text.slice(r.pos+l.length,r.length);if(u){l=r.text+l}if(f){l=l+r.text}h=r.desc.getText().length;d="";try{if(e.length===1){if(!r.pos){d=e}else if(r.pos>0){d=l.substring(0,r.pos+1)}}}catch(w){}if(h===1&&l.length>1&&e.length===1){if(r.desc.type===31||r.desc.type===25){this._disableSmartInputMode=true}}c={val:e,pos:r.pos,offset:0,isreset:false};a=r.desc.setText(l,e.length===1?false:true,c);this._disableSmartInputMode=false;if(!a&&typeof d!=="undefined"&&d.length>0&&(r.desc.type===26||r.desc.type===27||r.desc.type===100||r.desc.type===101||r.desc.type===250||r.desc.type===251)){a=r.desc.setText(d,e.length===1?false:true,c)}if(a){n.hint=n.success;n.testPosition=s+c.offset;if(e.length===1){v=r.desc.getText().length;p=r.pos;if(r.pos>v-1){p=v}m=v-h;if(m>0&&r.pos===h-1){p=v-1}g=this.toString();n.testPosition=r.desc.startIndex+p+c.offset}o=o.slice(r.length-r.pos,o.length)}else{n.hint=n.invalidInput;if(n.testPosition!==-1){n.testPosition=t}if(r.desc.type!==-1&&e.length===1){return false}}s=s+r.length}else{y=this.getFirstDelimiterPos(o,i);if(y<0){y=0}l=o.substring(0,y+1);c={val:e,pos:r.pos,offset:0,isreset:false};a=r.desc.setText(l,e.length===1?false:true,c);if(a){n.hint=n.success;n.testPosition=s+c.offset;o=o.slice(y+1,o.length)}else{n.hint=n.invalidInput;if(n.testPosition!==-1){n.testPosition=t}}if(y<0){y=0}b=y+1;s=s+b}}return a},removeAt:function(e,t,n){try{var r=this.desPostions[e],i,s,o,u,a=this.inputWidget,f=a.element,l=f.val().length;if(l===t+1&&e===0){a.isDeleteAll=true}if(r.desc.needAdjustInsertPos()){i="0";s=e;r.text=r.desc.getText();i=r.text.slice(0,r.pos)+i+r.text.slice(r.pos+i.length,r.length);o={val:i,pos:r.pos,offset:0,isreset:true,isfullreset:false};if(t-e+1>=r.length){o.isfullreset=true;e=e+r.length;s=e}u=r.desc.setText(i,false,o);if(u){n.hint=n.success;n.testPosition=s}else{n.hint=n.invalidInput;if(n.testPosition===-1){n.testPosition=e}}}if(e<t){this.removeAt(e+1,t,n)}return true}catch(c){return false}},incEnumPart:function(){var e=this.fields[this.inputWidget.options.activeField];if(e){e.inc()}return true},decEnumPart:function(e){var t=this.fields[this.inputWidget.options.activeField];if(t){t.dec()}return true},setValue:function(e){this.setDate(new Date(e instanceof Date?e.getTime():e));return true},getValue:function(){return this.getDate()},_disableSmartInputMode:false,_isSmartInputMode:function(){if(this._disableSmartInputMode){return false}if(this.inputWidget){return this.inputWidget.options.smartInputMode}return true},_getInt:function(t,n,r,i){var s,o;for(s=i;s>=r;s--){o=t.substring(n,n+s);if(o.length<r){return null}if(e.wij.charValidator.isDigit(o)){return o}}return null},_tryParseDate:function(e,t){var n=this._getCulture().calendars,r,i,s,o;t=t||n.standard.patterns.d;if(t){if(t.indexOf("MMM")===-1&&t.indexOf("MMMM")===-1){t=t.replace("MM","M")}t=t.replace("dd","d");t=t.replace("tt","a")}r=t.replace("yyyy","yy");i=n.standard["/"];s=[t,r,t.replace(new RegExp(i,"g"),"-"),r.replace(new RegExp(i,"g"),"-"),t.replace(new RegExp(i,"g"),"."),r.replace(new RegExp(i,"g"),".")];o=Globalize.parseDate(e,s,this._getCulture());if(o){return o}o=new Date(e);if(o.toString()!=="Invalid Date"&&e&&e!==""){return o}return 0},paddingZero:function(e,t){var n=""+e+"";while(n.length<t){n="0"+n}return n},_formatDate:function(e,t,n){if(!e.valueOf()){return"Â "}var r=this,i=this.inputWidget._getCulture().calendars.standard,s=t.replace(new RegExp("yyyy|MMMM|MMM|MM|M|mm|m|dddd|ddd|dd|d|hh|h|HH|H|ss|s|tt|t|a/p","gi"),function(t){var s;switch(t){case"yyyy":return e.getFullYear();case"MMMM":return n.dateTimeFormat.monthNames[e.getMonth()];case"MMM":return n.dateTimeFormat.abbreviatedMonthNames[e.getMonth()];case"MM":return r.paddingZero(e.getMonth()+1,2);case"M":return r.paddingZero(e.getMonth()+1,1);case"mm":return r.paddingZero(e.getMinutes(),2);case"m":return r.paddingZero(e.getMinutes(),1);case"dddd":return n.dateTimeFormat.dayNames[e.getDay()];case"ddd":return n.dateTimeFormat.abbreviatedDayNames[e.getDay()];case"dd":return r.paddingZero(e.getDate(),2);case"d":return r.paddingZero(e.getDate(),1);case"hh":s=e.getHours()%12;return r.paddingZero(s?s:12,2);case"h":s=e.getHours()%12;return r.paddingZero(s?s:12,1);case"HH":return r.paddingZero(e.getHours(),2);case"H":return r.paddingZero(e.getHours(),1);case"ss":return r.paddingZero(e.getSeconds(),2);case"s":return r.paddingZero(e.getSeconds(),1);case"tt":return e.getHours()<12?i.AM[0]:i.PM[0];case"t":return e.getHours()<12?i.AM[0].length>0?i.AM[0].charAt(0):"":i.PM[0].length>0?i.PM[0].charAt(0):"";case"a/p":return e.getHours()<12?"a":"p"}return"N"});return s}};n=function(e,t,n,r){this._txtProvider=e;this.id=t;this.type=n;this.startIndex=0;this.maxLen=r||2};n.prototype={_txtProvider:null,id:0,type:0,name:null,startIndex:0,maxLen:2,getText:function(){return null},setText:function(e,t,n){return false},inc:function(){},dec:function(){},needAdjustInsertPos:function(){return true},reachMaxLen:function(){var e=this.getText();do{if(e.charAt(0)==="0"){e=e.slice(1)}else{break}}while(e.length>0);return e.length>=this.maxLen}};r=function(e,t){for(var n in t.prototype){if(!e.prototype[n]){e.prototype[n]=t.prototype[n]}}};i=function(e,t){r(i,n);n.apply(this,[e,t,-1,100])};i.prototype={liternal:"",getText:function(){return this.liternal}};s=function(e,t){r(s,n);n.apply(this,[e,t,20]);this.name="Two-digit month"};s.prototype={getText:function(){var e=""+this._txtProvider.getMonth()+"";return e.length===1?"0"+e:e},setText:function(e,t,n){return this._txtProvider.setMonth(e,t,n)},inc:function(){this._txtProvider.setMonth(this._txtProvider.getMonth()*1+1,true)},dec:function(){this._txtProvider.setMonth(this._txtProvider.getMonth()*1-1,true)}};o=function(e,t){r(o,n);n.apply(this,[e,t,25]);this.name="month"};o.prototype={getText:function(){var e=""+this._txtProvider.getMonth()+"";return e},setText:function(e,t,n){return this._txtProvider.setMonth(e,t,n)},inc:function(){this._txtProvider.setMonth(this._txtProvider.getMonth()*1+1,true)},dec:function(){this._txtProvider.setMonth(this._txtProvider.getMonth()*1-1,true)}};u=function(e,t){r(u,n);n.apply(this,[e,t,26,100]);this.name="AbbreviatedMonthNames"};u.prototype={getText:function(){var e=this._txtProvider.getMonth(),t=this._txtProvider._getCulture();return t.calendars.standard.months.namesAbbr[e-1]},setText:function(e,t,n){var r=-1,i=this.inputWidget._getCulture().calendars.standard;r=this._txtProvider.findAlikeArrayItemIndex(i.months.namesAbbr,e);if(r===-1){return false}return this._txtProvider.setMonth(r+1,t,n)},inc:function(){this._txtProvider.setMonth(this._txtProvider.getMonth()*1+1,true)},dec:function(){this._txtProvider.setMonth(this._txtProvider.getMonth()*1-1,true)}};a=function(e,t){r(a,n);n.apply(this,[e,t,27,100]);this.name="MonthNames"};a.prototype={getText:function(){var e=this._txtProvider.getMonth(),t=this._txtProvider._getCulture();return t.calendars.standard.months.names[e-1]},setText:function(e,t,n){var r=-1,i;if(n&&n.isfullreset){r=1}else{i=this._txtProvider._getCulture();r=this._txtProvider.findAlikeArrayItemIndex(i.calendars.standard.months.names,e);if(r===-1){return false}}return this._txtProvider.setMonth(r+1,t,n)},inc:function(){this._txtProvider.setMonth(this._txtProvider.getMonth()*1+1,true)},dec:function(){this._txtProvider.setMonth(this._txtProvider.getMonth()*1-1,true)}};f=function(e,t){r(f,n);n.apply(this,[e,t,30]);this.name="Two-digit day of month"};f.prototype={getText:function(){var e=this._txtProvider.getDayOfMonth();if(e<10){e="0"+e}return""+e+""},setText:function(e,t,n){return this._txtProvider.setDayOfMonth(e,t,n)},inc:function(){this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth()*1+1,true)},dec:function(){this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth()*1-1,true)}};l=function(e,t){r(l,n);n.apply(this,[e,t,31]);this.name="Day of month"};l.prototype={getText:function(){var e=this._txtProvider.getDayOfMonth();return""+e+""},setText:function(e,t,n){return this._txtProvider.setDayOfMonth(e,t,n)},inc:function(){this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth()*1+1,true)},dec:function(){this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth()*1-1,true)}};c=function(e,t){r(c,n);n.apply(this,[e,t,100,100]);this.name="AbbreviatedDayNames"};c.prototype={getText:function(){var e=this._txtProvider.getDayOfWeek(),t=this._txtProvider._getCulture();return t.calendars.standard.days.namesShort[e-1]},setText:function(e,t,n){var r=-1,i=this._txtProvider._getCulture();r=this._txtProvider.findAlikeArrayItemIndex(i.calendars.standard.days.namesShort,e);if(r===-1){return false}return this._txtProvider.setDayOfWeek(r+1)},inc:function(){this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth()*1+1,true)},dec:function(){this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth()*1-1,true)},needAdjustInsertPos:function(){return false}};h=function(e,t){r(h,n);n.apply(this,[e,t,101,100]);this.name="DayNames"};h.prototype={getText:function(){var e=this._txtProvider.getDayOfWeek(),t=this._txtProvider._getCulture();return t.calendars.standard.days.names[e-1]},setText:function(e,t,n){var r=-1,i=this._txtProvider._getCulture();r=this._txtProvider.findAlikeArrayItemIndex(i.calendars.standard.days.names,e);if(r===-1){return false}return this._txtProvider.setDayOfWeek(r+1)},inc:function(){this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth()*1+1,true)},dec:function(){this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth()*1-1,true)},needAdjustInsertPos:function(){return false}};p=function(e,t){r(p,n);n.apply(this,[e,t,10,4]);this.name="Four-digit year"};p.prototype={getText:function(){return this._txtProvider.getYear()},setText:function(e,t,n){if(this._txtProvider._isSmartInputMode()&&n){var r=1900+100,i,s,o,u,a,f,l;if(this._txtProvider.inputWidget.options.startYear){r=this._txtProvider.inputWidget.options.startYear}i=r+100-1;r=this._txtProvider.paddingZero(r,4);i=this._txtProvider.paddingZero(i,4);if(n.pos===0||n.pos===1){s=new Date;o=this._txtProvider.paddingZero(this._txtProvider.getYear(),4);if(o.charAt(0)==="0"&&o.charAt(1)==="0"&&n.pos<=1){u=n.val*1;a="00";if(u>=5){a=r.slice(0,2)}else{a=i.slice(0,2)}f=n.val+o.slice(3,4);l=a+f;n.offset=2-n.pos;this._txtProvider.setYear(l,n);return true}}}return this._txtProvider.setYear(e,n)},inc:function(){this._txtProvider.setYear(this._txtProvider.getYear()*1+1,null,true)},dec:function(){this._txtProvider.setYear(this._txtProvider.getYear()*1-1,null,true)}};d=function(e,t){r(d,n);n.apply(this,[e,t,1]);this.name="One-digit year"};d.prototype={getText:function(){var e=this._txtProvider.getYear();e=""+e+"";if(e.length===4){e=e.charAt(2)+e.charAt(3)}if(e.charAt(0)==="0"){e=e.charAt(1)}return e},setText:function(e,t,n){e=e+"";while(e.length<2){e="0"+e}var r=this._txtProvider.getYear(),i,s,o,u,a;r=""+r+"";if(e==="00"){i=this._txtProvider.getMonth();s=this._txtProvider.getDayOfMonth();o=this._txtProvider.getHours();u=this._txtProvider.getMinutes();a=this._txtProvider.getSeconds();if(i===1&&s===1&&!o&&!u&&!a){r="0001";e="01"}}if(r.length>=2){r=r.charAt(0)+r.charAt(1)+e.charAt(0)+e.charAt(1)}return this._txtProvider.setYear(r,n)},inc:function(){this._txtProvider.setYear(this._txtProvider.getYear()*1+1,null,true)},dec:function(){this._txtProvider.setYear(this._txtProvider.getYear()*1-1,null,true)}};v=function(e,t){r(v,n);n.apply(this,[e,t,2]);this.name="Two-digit year"};v.prototype={getText:function(){var e=this._txtProvider.getYear();e=""+e+"";if(e.length===4){e=e.charAt(2)+e.charAt(3)}return e},setText:function(e,t,n){e=e+"";while(e.length<2){e="0"+e}var r=this._txtProvider.getYear(),i,s,o,u,a,f;r=""+r+"";if(e==="00"){i=this._txtProvider.getMonth();s=this._txtProvider.getDayOfMonth();o=this._txtProvider.getHours();u=this._txtProvider.getMinutes();a=this._txtProvider.getSeconds();if(i===1&&s===1&&!o&&!u&&!a){r="0001";e="01"}}if(r.length>=2){r=r.charAt(0)+r.charAt(1)+e.charAt(0)+e.charAt(1)}f=this._txtProvider.setYear(r,n);return f},inc:function(){this._txtProvider.setYear(this._txtProvider.getYear()*1+1,null,true)},dec:function(){this._txtProvider.setYear(this._txtProvider.getYear()*1-1,null,true)}};m=function(e,t){r(m,n);n.apply(this,[e,t,45]);this.name="h"};m.prototype={getText:function(){var e=this._txtProvider.getHours();if(e>12){e=e-12}else if(e===0){e=12}return""+e+""},setText:function(e,t,n){var r=this._txtProvider.getHours();if(r>12){e=e*1+12}return this._txtProvider.setHours(e,t)},inc:function(){this._txtProvider.setHours(this._txtProvider.getHours()*1+1,true)},dec:function(){this._txtProvider.setHours(this._txtProvider.getHours()*1-1,true)}};g=function(e,t){r(g,n);n.apply(this,[e,t,46]);this.name="hh"};g.prototype={getText:function(){var e=this._txtProvider.getHours();if(e>12){e=e-12}else if(e===0){e="12"}if(e<10){e="0"+e}return""+e+""},setText:function(e,t,n){var r=this._txtProvider.getHours();if(r>12){e=e*1+12}return this._txtProvider.setHours(e,t)},inc:function(){this._txtProvider.setHours(this._txtProvider.getHours()*1+1,true)},dec:function(){this._txtProvider.setHours(this._txtProvider.getHours()*1-1,true)}};y=function(e,t){r(y,n);n.apply(this,[e,t,47]);this.name="H"};y.prototype={getText:function(){var e=this._txtProvider.getHours();return""+e+""},setText:function(e,t,n){return this._txtProvider.setHours(e,t)},inc:function(){this._txtProvider.setHours(this._txtProvider.getHours()*1+1,true)},dec:function(){this._txtProvider.setHours(this._txtProvider.getHours()*1-1,true)}};b=function(e,t){r(b,n);n.apply(this,[e,t,48]);this.name="HH"};b.prototype={getText:function(){var e=this._txtProvider.getHours();if(e<10){e="0"+e}return""+e+""},setText:function(e,t,n){return this._txtProvider.setHours(e,t)},inc:function(){this._txtProvider.setHours(this._txtProvider.getHours()*1+1,true)},dec:function(){this._txtProvider.setHours(this._txtProvider.getHours()*1-1,true)}};w=function(e,t){r(w,n);n.apply(this,[e,t,250]);this.name="t"};w.prototype={getText:function(){var e=this._txtProvider.getHours(),t="",n=this._txtProvider._getCulture();if(e<12){t=n.calendars.standard.AM[0]}else{t=n.calendars.standard.PM[0]}if(t.length<=0){t=" "}return t.charAt(0)},setText:function(e,t,n){var r;if(e.toLowerCase().indexOf("a")>=0){r=this._txtProvider.getHours()*1%12;this._txtProvider.setHours(r,true)}else if(e.toLowerCase().indexOf("p")>=0){r=this._txtProvider.getHours()*1%12+12;this._txtProvider.setHours(r,true)}},inc:function(){var e=(this._txtProvider.getHours()*1+12)%24;this._txtProvider.setHours(e,true)},dec:function(){var e=(this._txtProvider.getHours()*1+12)%24;this._txtProvider.setHours(e,true)}};E=function(e,t){r(E,n);n.apply(this,[e,t,251]);this.name="tt"};E.prototype={getText:function(){var e=this._txtProvider.getHours(),t="",n=this._txtProvider._getCulture();if(e<12){t=n.calendars.standard.AM[0]}else{t=n.calendars.standard.PM[0]}if(t.length<=0){t=" "}return t},setText:function(e,t,n){var r;if(e.toLowerCase().indexOf("a")>=0){r=this._txtProvider.getHours()*1%12;this._txtProvider.setHours(r,true)}else if(e.toLowerCase().indexOf("p")>=0){r=this._txtProvider.getHours()*1%12+12;this._txtProvider.setHours(r,true)}return true},inc:function(){var e=(this._txtProvider.getHours()*1+12)%24;this._txtProvider.setHours(e,true)},dec:function(){var e=(this._txtProvider.getHours()*1+12)%24;this._txtProvider.setHours(e,true)}};S=function(e,t){r(S,n);n.apply(this,[e,t,50]);this.name="mm"};S.prototype={getText:function(){var e=this._txtProvider.getMinutes();if(e<10){e="0"+e}return""+e+""},setText:function(e,t,n){if(n&&n.isfullreset){e="0"}return this._txtProvider.setMinutes(e,t)},inc:function(){this._txtProvider.setMinutes(this._txtProvider.getMinutes()*1+1,true)},dec:function(){this._txtProvider.setMinutes(this._txtProvider.getMinutes()*1-1,true)}};x=function(e,t){r(x,n);n.apply(this,[e,t,51]);this.name="m"};x.prototype={getText:function(){var e=this._txtProvider.getMinutes();return""+e+""},setText:function(e,t,n){if(n&&n.isfullreset){e="0"}return this._txtProvider.setMinutes(e,t)},inc:function(){this._txtProvider.setMinutes(this._txtProvider.getMinutes()*1+12,true)},dec:function(){this._txtProvider.setMinutes(this._txtProvider.getMinutes()*1-12,true)}};T=function(e,t){r(T,n);n.apply(this,[e,t,60]);this.name="ss"};T.prototype={getText:function(){var e=this._txtProvider.getSeconds();if(e<10){e="0"+e}return""+e+""},setText:function(e,t,n){if(n&&n.isfullreset){e="0"}return this._txtProvider.setSeconds(e,t)},inc:function(){this._txtProvider.setSeconds(this._txtProvider.getSeconds()*1+12,true)},dec:function(){this._txtProvider.setSeconds(this._txtProvider.getSeconds()*1-12,true)}};N=function(e,t){r(N,n);n.apply(this,[e,t,61]);this.name="s"};N.prototype={getText:function(){var e=this._txtProvider.getSeconds();return""+e+""},setText:function(e,t,n){if(n&&n.isfullreset){e="0"}return this._txtProvider.setSeconds(e,t)},inc:function(){this._txtProvider.setSeconds(this._txtProvider.getSeconds()*1+12,true)},dec:function(){this._txtProvider.setSeconds(this._txtProvider.getSeconds()*1-12,true)}}})(jQuery)