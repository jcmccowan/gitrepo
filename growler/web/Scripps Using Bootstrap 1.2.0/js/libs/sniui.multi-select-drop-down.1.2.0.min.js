var multiselectID=0;$.widget("sniui.multiSelectDropDown",$.extend({},$.ech.multiselect.prototype,{_create:function(){this.options.checkAllText="Check All";this.options.uncheckAllText="Uncheck All";var d=this.element.hide(),f=this.options;this.speed=$.fx.speeds._default;this._isOpen=false;var c=(this.button=$('<button type="button"><span class="ui-icon ui-icon-triangle-2-n-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(f.classes).attr({title:d.attr("title"),"aria-haspopup":true,tabIndex:d.attr("tabIndex")}).insertAfter(d),a=(this.buttonlabel=$("<span />")).html(f.noneSelectedText).appendTo(c),e=(this.menu=$("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(f.classes).appendTo(".multiSelectDropDown"),h=(this.header=$("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(e),b=(this.headerLinkContainer=$("<ul />")).addClass("ui-helper-reset").html(function(){if(f.header===true){return'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+f.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+f.uncheckAllText+"</span></a></li>"}else{if(typeof f.header==="string"){return"<li>"+f.header+"</li>"}else{return""}}}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(h),g=(this.checkboxContainer=$("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(e);this._bindEvents();this.refresh(true);if(!f.multiple){e.addClass("ui-multiselect-single")}},refresh:function(f){var c=this.element,e=this.options,d=this.menu,h=this.checkboxContainer,a=[],b="",g=c.attr("id")||multiselectID++;c.find("option").each(function(l){var m=$(this),r=this.parentNode,p=this.innerHTML,t=this.title,q=this.value,k="ui-multiselect-"+(this.id||g+"-option-"+l),u=this.disabled,j=this.selected,o=["ui-corner-all"],n=(u?"ui-multiselect-disabled ":" ")+this.className,s;if(r.tagName==="OPTGROUP"){s=r.getAttribute("label");if($.inArray(s,a)===-1){b+='<li class="ui-multiselect-optgroup-label '+r.className+'"><a href="#">'+s+"</a></li>";a.push(s)}}if(u){o.push("ui-state-disabled")}if(j&&!e.multiple){o.push("ui-state-active")}b+='<li class="'+n+'">';b+='<label for="'+k+'" title="'+t+'" class="'+o.join(" ")+'">';b+='<input id="'+k+'" name="multiselect_'+g+'" type="'+(e.multiple?"checkbox":"radio")+'" value="'+q+'" title="'+p+'"';if(j){b+=' checked="checked"';b+=' aria-selected="true"'}else{b+=' aria-selected="false"'}if(u){b+=' disabled="disabled"';b+=' aria-disabled="true"'}b+=' /><span id="'+k+'_wrap" class="wrap unchecked"><span>'+p+"</span></span></label></li>"});h.html(b);this.labels=d.find("label");this.inputs=this.labels.children("input");this._setButtonWidth();this._setMenuWidth();this.button[0].defaultValue=this.update();if(!f){this._trigger("refresh")}},_bindEvents:function(){var a=this,b=this.button;function c(){a[a._isOpen?"close":"open"]();return false}b.find("span").bind("click.multiselect",c);b.bind({click:c,keypress:function(d){switch(d.which){case 27:case 38:case 37:a.close();break;case 39:case 40:a.open();break}},mouseenter:function(){if(!b.hasClass("ui-state-disabled")){$(this).addClass("ui-state-hover")}},mouseleave:function(){$(this).removeClass("ui-state-hover")},focus:function(){if(!b.hasClass("ui-state-disabled")){$(this).addClass("ui-state-focus")}},blur:function(){$(this).removeClass("ui-state-focus")}});this.header.delegate("a","click.multiselect",function(d){if($(this).hasClass("ui-multiselect-close")){a.close()}else{a[$(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"]()}d.preventDefault()});this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(i){i.preventDefault();var h=$(this),g=h.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),d=g.get(),f=h.parent().text();if(a._trigger("beforeoptgrouptoggle",i,{inputs:d,label:f})===false){return}a._toggleChecked(g.filter(":checked").length!==g.length,g);a._trigger("optgrouptoggle",i,{inputs:d,label:f,checked:d[0].checked})}).delegate("label","keydown.multiselect",function(d){d.preventDefault();switch(d.which){case 9:case 27:a.close();break;case 38:case 40:case 37:case 39:a._traverse(d.which,this);break;case 13:$(this).find("input")[0].click();break}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(h){var g=$(this),i=this.value,f=this.checked,d=a.element.find("option");if(this.disabled||a._trigger("click",h,{value:i,text:this.title,checked:f})===false){h.preventDefault();return}g.focus();g.attr("aria-selected",f);d.each(function(){if(this.value===i){this.selected=f}else{if(!a.options.multiple){this.selected=false}}});if(!a.options.multiple){a.labels.removeClass("ui-state-active");g.closest("label").toggleClass("ui-state-active",f);a.close()}a.element.trigger("change");setTimeout($.proxy(a.update,a),10)});$(document).bind("mousedown.multiselect",function(d){if(a._isOpen&&!$.contains(a.menu[0],d.target)&&!$.contains(a.button[0],d.target)&&d.target!==a.button[0]){a.close()}});$(this.element[0].form).bind("reset.multiselect",function(){setTimeout($.proxy(a.refresh,a),10)})},_toggleChecked:function(a,e){var d=(e&&e.length)?e:this.inputs,c=this;d.each(this._toggleState("checked",a));d.eq(0).focus();this.update();var b=d.map(function(){return this.value}).get();this.element.find("option").each(function(){if(!this.disabled&&$.inArray(this.value,b)>-1){c._toggleState("selected",a).call(this)}});if(d.length){this.element.trigger("change")}this._toggleAllState(a)},_toggleAllState:function(b){var a=$('span[id^="ui-multiselect-"]');if(b==true){a.each(function(){$(this).removeClass("unchecked");$(this).addClass("checked")})}else{a.each(function(){$(this).removeClass("checked");$(this).addClass("unchecked")})}},open:function(f){var j=this,d=this.button,a=this.menu,c=this.speed,b=this.options,g=[];if(this._trigger("beforeopen")===false||d.hasClass("ui-state-disabled")||this._isOpen){return}var i=a.find("ul").last(),k=b.show,h=d.offset();if($.isArray(b.show)){k=b.show[0];c=b.show[1]||j.speed}if(k){g=[k,c]}i.scrollTop(0).height(b.height);if($.ui.position&&!$.isEmptyObject(b.position)){b.position.of=b.position.of||d;a.show().position(b.position).hide()}else{a.css({left:h.left})}$.fn.show.apply(a,g);this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");d.addClass("ui-state-active");this._isOpen=true;this._trigger("open")},}));$.sniui.multiSelectDropDown.defaults=$.extend({},$.ech.multiselect.defaults);$(function(){$('label[for^="ui-multiselect-"]').click(function(){var a=$(this).find("span").attr("id").replace("_wrap","");if($(this).find("input").attr("id",a).prop("checked")==true){$("span[id="+a+"_wrap]").removeClass("checked");$("span[id="+a+"_wrap]").addClass("unchecked");$(this).find("input").attr("id",a).prop("checked",false)}else{$("span[id="+a+"_wrap]").removeClass("unchecked");$("span[id="+a+"_wrap]").addClass("checked");$(this).find("input").attr("id",a).prop("checked",true)}})});